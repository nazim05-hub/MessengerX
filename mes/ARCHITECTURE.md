# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Client (Browser)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   React UI   ‚îÇ  ‚îÇ  Service     ‚îÇ  ‚îÇ   IndexedDB  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (Mantine)  ‚îÇ  ‚îÇ   Worker     ‚îÇ  ‚îÇ   (Dexie)    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                  ‚îÇ                  ‚îÇ
          ‚îÇ HTTP/WS          ‚îÇ Cache            ‚îÇ Offline
          ‚îÇ                  ‚îÇ                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Caddy (Reverse Proxy)               ‚îÇ
‚îÇ                         SSL/TLS                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                  ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   Frontend       ‚îÇ   ‚îÇ    Backend        ‚îÇ
        ‚îÇ   (Nginx)        ‚îÇ   ‚îÇ    (FastAPI)      ‚îÇ
        ‚îÇ   Port 3000      ‚îÇ   ‚îÇ    Port 8000      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                   ‚îÇ                   ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  PostgreSQL  ‚îÇ   ‚îÇ     Redis       ‚îÇ  ‚îÇ   Coturn    ‚îÇ
            ‚îÇ   Port 5432  ‚îÇ   ‚îÇ   Port 6379     ‚îÇ  ‚îÇ  Port 3478  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
src/
‚îú‚îÄ‚îÄ components/          # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Auth/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ Chat/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ Call/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–≤–æ–Ω–∫–æ–≤
‚îú‚îÄ‚îÄ pages/              # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ stores/             # Zustand stores (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ api.ts         # REST API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ websocket.ts   # WebSocket –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ webrtc.ts      # WebRTC –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ indexeddb.ts   # –û—Ñ–ª–∞–π–Ω —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îú‚îÄ‚îÄ types/              # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ App.tsx            # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îî‚îÄ‚îÄ main.tsx           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
User Action
    ‚Üì
Component
    ‚Üì
Store Action (Zustand)
    ‚Üì
Service (API/WebSocket/WebRTC)
    ‚Üì
Backend
    ‚Üì
Database/Redis
    ‚Üì
WebSocket Push
    ‚Üì
Store Update
    ‚Üì
Component Re-render
```

### State Management (Zustand)

- **authStore**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **chatStore**: –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- **callStore**: –ó–≤–æ–Ω–∫–∏ –∏ WebRTC —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **wsStore**: WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## Backend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ routers/            # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ auth.py        # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ users.py       # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ chats.py       # –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ calls.py       # –ó–≤–æ–Ω–∫–∏
‚îú‚îÄ‚îÄ models.py          # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ schemas.py         # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ database.py        # Database setup
‚îú‚îÄ‚îÄ auth.py            # JWT –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ websocket_manager.py  # WebSocket –º–µ–Ω–µ–¥–∂–µ—Ä
‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ main.py            # FastAPI app
```

### API Endpoints

#### Auth
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `POST /api/auth/verify-email` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
- `POST /api/auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /api/auth/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/logout` - –í—ã—Ö–æ–¥

#### Users
- `GET /api/users/` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GET /api/users/{id}` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/users/me` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `POST /api/users/me/avatar` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä

#### Chats
- `GET /api/chats/` - –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- `POST /api/chats/` - –°–æ–∑–¥–∞—Ç—å —á–∞—Ç
- `GET /api/chats/{id}` - –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç
- `GET /api/chats/{id}/messages` - –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
- `POST /api/chats/{id}/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `PUT /api/chats/messages/{id}` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `DELETE /api/chats/messages/{id}` - –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

#### Calls
- `POST /api/calls/` - –°–æ–∑–¥–∞—Ç—å –∑–≤–æ–Ω–æ–∫
- `PUT /api/calls/{id}/accept` - –ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫
- `PUT /api/calls/{id}/reject` - –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫
- `PUT /api/calls/{id}/end` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫
- `GET /api/calls/history` - –ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤

#### WebSocket
- `WS /ws/{token}` - WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü—ã

**users**
- id, email, username, hashed_password
- full_name, phone_number, avatar, status
- user_status, is_active, is_email_verified
- created_at, updated_at

**chats**
- id, name, is_group, avatar
- created_by, created_at, updated_at

**messages**
- id, chat_id, sender_id, content
- message_type, file_url, reply_to
- is_edited, is_deleted
- created_at, updated_at

**calls**
- id, chat_id, initiator_id
- call_type, status
- started_at, ended_at

**message_reactions**
- id, message_id, user_id, emoji

**message_reads**
- id, message_id, user_id, read_at

**chat_participants** (many-to-many)
- chat_id, user_id

### Redis –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

- **–û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—ã**: `user_status:{user_id}`
- **–ù–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞**: `typing:{chat_id}:{user_id}`
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## WebSocket –ø—Ä–æ—Ç–æ–∫–æ–ª

### Client ‚Üí Server

```json
// –ù–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞
{
  "type": "typing",
  "chat_id": 1,
  "is_typing": true
}

// –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
{
  "type": "message_read",
  "message_id": 123
}

// WebRTC —Å–∏–≥–Ω–∞–ª–∏–Ω–≥
{
  "type": "webrtc_signal",
  "target_user_id": 2,
  "data": {
    "type": "offer",
    "offer": {...}
  }
}

// Heartbeat
{
  "type": "ping"
}
```

### Server ‚Üí Client

```json
// –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
{
  "type": "new_message",
  "data": {
    "id": 123,
    "chat_id": 1,
    "sender_id": 2,
    "content": "Hello!",
    "created_at": "2024-01-01T12:00:00Z",
    "sender": {...}
  }
}

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç
{
  "type": "user_typing",
  "data": {
    "chat_id": 1,
    "user_id": 2,
    "is_typing": true,
    "username": "alice"
  }
}

// –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫
{
  "type": "incoming_call",
  "data": {
    "call_id": 1,
    "chat_id": 1,
    "initiator_id": 2,
    "call_type": "video",
    "initiator": {...}
  }
}

// –°—Ç–∞—Ç—É—Å –∑–≤–æ–Ω–∫–∞
{
  "type": "call_accepted",
  "data": {
    "call_id": 1,
    "user_id": 3
  }
}

// WebRTC —Å–∏–≥–Ω–∞–ª
{
  "type": "webrtc_signal",
  "data": {
    "from_user_id": 2,
    "signal_type": "answer",
    "signal": {...}
  }
}
```

## WebRTC –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –∑–≤–æ–Ω–∫–∞

```
Alice                    Server                     Bob
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îú‚îÄ Create Call ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îú‚îÄ Incoming Call ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îú‚îÄ getUserMedia() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îú‚îÄ Create Offer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îú‚îÄ Offer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Accept Call ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Create Answer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Answer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                         ‚îÇ
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îú‚îÄ ICE Candidate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ                         ‚îÇ
  ‚îÇ                        ‚îú‚îÄ ICE Candidate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îÇ<‚îÄ‚îÄ‚îÄ ICE Candidate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                         ‚îÇ
  ‚îÇ                        ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ ICE Candidate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
  ‚îÇ                        ‚îÇ                         ‚îÇ
  ‚îÇ<‚ïê‚ïê‚ïê‚ïê P2P Media Stream ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê>‚îÇ
```

### ICE Servers

1. **STUN**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP
2. **TURN**: –†–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä (–∫–æ–≥–¥–∞ P2P –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω)

## PWA –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Service Worker

```
Browser
    ‚Üì
Service Worker (Interceptor)
    ‚Üì
    ‚îú‚îÄ Cache Hit? ‚îÄ‚îÄ> Return from Cache
    ‚îÇ
    ‚îî‚îÄ Cache Miss ‚îÄ‚îÄ> Fetch from Network
                          ‚Üì
                     Update Cache
                          ‚Üì
                     Return Response
```

### Offline Strategy

1. **Network First**: API –∑–∞–ø—Ä–æ—Å—ã
2. **Cache First**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
3. **Cache Only**: –û—Ñ–ª–∞–π–Ω fallback

### IndexedDB Schema

```
MessengerDB
‚îú‚îÄ‚îÄ chats (id, created_at)
‚îú‚îÄ‚îÄ messages (id, chat_id, created_at)
‚îî‚îÄ‚îÄ users (id, username, email)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email + password
2. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. Backend –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT access + refresh —Ç–æ–∫–µ–Ω—ã
4. Access —Ç–æ–∫–µ–Ω –∂–∏–≤—ë—Ç 30 –º–∏–Ω—É—Ç
5. Refresh —Ç–æ–∫–µ–Ω –∂–∏–≤—ë—Ç 7 –¥–Ω–µ–π
6. Frontend —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã –≤ localStorage
7. Access —Ç–æ–∫–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
8. –ü—Ä–∏ 401 - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ refresh —Ç–æ–∫–µ–Ω

### WebSocket

- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ URL –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø–µ—Ä–µ–¥ accept
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ invalid token

### CORS

- –ù–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ backend –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ

1. **Backend**: –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ Uvicorn
2. **Frontend**: Nginx load balancer
3. **PostgreSQL**: Read replicas
4. **Redis**: Redis Cluster

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ

1. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- **Backend**: Response time, Error rate, Active connections
- **Database**: Query time, Connection pool
- **Redis**: Memory usage, Hit rate
- **WebSocket**: Active connections, Message rate
- **WebRTC**: Connection success rate, Quality metrics

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **Backend**: Uvicorn logs
- **Frontend**: Console errors
- **Database**: Query logs
- **WebSocket**: Connection/disconnection events

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Frontend**:
   - Code splitting
   - Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –úemoization (React.memo, useMemo)
   - –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤

2. **Backend**:
   - Database connection pooling
   - Query optimization (indexes)
   - Redis caching
   - Async operations

3. **Network**:
   - Gzip compression
   - CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
   - WebSocket –¥–ª—è real-time

4. **Database**:
   - Indexes –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
   - Pagination –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
   - Eager loading –¥–ª—è relationships

